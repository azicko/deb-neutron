Description: CVE-2014-7821: Fix hostname regex pattern
 Current hostname_pattern regex complexity grows exponentially when given a
 string of just digits, which can be exploited to cause neutron-server to
 freeze.
Author: John Perkins <john.perkins@rackspace.com>
Origin: upstream, https://review.openstack.org/#/c/135624/
Date:   Mon Oct 6 16:24:57 2014 -0500
Bug-Debian: https://bugs.debian.org/770431
Bug-Ubuntu: https://launchpad.net/bugs/1378450
Last-Update: 2014-11-21

Index: neutron/neutron/api/v2/attributes.py
===================================================================
--- neutron.orig/neutron/api/v2/attributes.py	2014-10-25 16:10:17.000000000 +0800
+++ neutron/neutron/api/v2/attributes.py	2014-11-21 16:22:21.000000000 +0800
@@ -537,8 +537,8 @@
         return [data]
 
 
-HOSTNAME_PATTERN = ("(?=^.{1,254}$)(^(?:(?!\d+\.|-)[a-zA-Z0-9_\-]"
-                    "{1,63}(?<!-)\.?)+(?:[a-zA-Z]{2,})$)")
+HOSTNAME_PATTERN = ("(?=^.{1,254}$)(^(?:(?!\d+.|-)[a-zA-Z0-9_\-]{1,62}"
+                    "[a-zA-Z0-9]\.?)+(?:[a-zA-Z]{2,})$)")
 
 HEX_ELEM = '[0-9A-Fa-f]'
 UUID_PATTERN = '-'.join([HEX_ELEM + '{8}', HEX_ELEM + '{4}',
Index: neutron/neutron/tests/unit/test_attributes.py
===================================================================
--- neutron.orig/neutron/tests/unit/test_attributes.py	2014-10-25 16:10:17.000000000 +0800
+++ neutron/neutron/tests/unit/test_attributes.py	2014-11-21 16:22:21.000000000 +0800
@@ -283,6 +283,7 @@
                     ['www.hostname.com', 'www.hostname.com'],
                     ['77.hostname.com'],
                     ['1000.0.0.1'],
+                    ['111111111111111111111111111111111111111111111111111111111111'],  # noqa
                     None]
 
         for ns in ns_pools:
